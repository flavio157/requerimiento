create table T_CAJA_TEMPORAL(
NRO_CORRELATIVO char(9),
DESCRIPCION varchar(100),
FEC_GASTO datetime,
FEC_COBRO datetime,
COD_PERSONAL char(5),
COD_USUARIO char(5),
OFICINA_USUARIO char(30),
MONTO decimal(9,2),
EST_CAJA char(1),
FEC_REGISTRO datetime
)



create table T_CAJA_ITEM(
NRO_CORRELATIVO char(9),
COD_MOVICAJA char(9),
COD_CONCEPTOCAJA char(5),
TIP_DOCUMENTO char(2),
TIP_OPERACION char(1),
TIP_REGISTRO char(1),
FEC_GASTO datetime,
NUM_REFERENCIA char(9),
COD_PERSONAL char(5),
DES_GASTO varchar(200),
MON_COBRADO decimal(9,2),
MON_GASOLINA decimal(9,2),
MON_COMISIONES decimal(9,2),
FEC_COBRO datetime,
MON_OTROS decimal(9,2),
MON_ADELANTO decimal(9,2),
MON_GASTO decimal(9,2),
MON_VALIDADO decimal(9,2)
)



create table T_CONCEPTO_MOVIMIENTO(
COD_CONCEPTOCAJA char(5),
DES_CONCEPTOCAJA char(100),
EST_CONCEPTOCAJA char(1),
USU_REGISTRO varchar(30),
FEC_REGISTRO datetime,
USU_MODIFICO varchar(30),
FEC_MODIFICO datetime,
CAJA char(1)
)



create view V_VERIFICAR_PAGO
as
select  c.* ,p.COD_PERSONAL as CODPERSONAL, p.NOM_PERSONAL1 as PERSONAL , m.DES_CONCEPTOCAJA as CONCEPTO from T_CAJA_ITEM as c
LEFT OUTER JOIN T_CAJA_TEMPORAL as t
on c.NRO_CORRELATIVO = t.NRO_CORRELATIVO
inner join T_CONCEPTO_MOVIMIENTO as m on
m.COD_CONCEPTOCAJA = c.COD_CONCEPTOCAJA
inner join T_PERSONAL as p on 
p.COD_PERSONAL = c.COD_PERSONAL
where t.NRO_CORRELATIVO IS null and m.DES_CONCEPTOCAJA = 'EFECTIVOS' and c.TIP_OPERACION = 'E' and c.FEC_GASTO >= '01-01-2021'







